<!DOCTYPE html>
<html>
<head>
    <title>Text-to-Speech Request</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            var audioContext;
            var audioBuffer;
            
            // Function to send the request
            function sendRequest(text) {
                var url = 'https://us-central1-texttospeech.googleapis.com/v1beta1/text:synthesize';
                var requestBody = {
                    "audioConfig": {
                        "audioEncoding": "LINEAR16",
                        "effectsProfileId": [
                            "small-bluetooth-speaker-class-device"
                        ],
                        "pitch": 0,
                        "speakingRate": 1
                    },
                    "input": {
                        "text": text
                    },
                    "voice": {
                        "languageCode": "en-US",
                        "name": "en-US-Neural2-J"
                    }
                };
                
                $.ajax({
                    type: 'POST',
                    url: url,
                    contentType: 'application/json',
                    data: JSON.stringify(requestBody),
                    success: function(response) {
                        decodeAudio(response.audioContent);
                    },
                    error: function(xhr, status, error) {
                        console.log('Error:', error); // Handle any errors here
                    }
                });
            }
            
            // Decode the audio content and create an audio buffer
            function decodeAudio(audioContent) {
                var audioData = base64ToArrayBuffer(audioContent);
                
                audioContext.decodeAudioData(audioData, function(buffer) {
                    audioBuffer = buffer;
                    enablePlayButton();
                }, function(error) {
                    console.log('Error decoding audio:', error);
                });
            }
            
            // Convert Base64 data to an ArrayBuffer
            function base64ToArrayBuffer(base64Data) {
                var binaryString = atob(base64Data);
                var length = binaryString.length;
                var bytes = new Uint8Array(length);
                
                for (var i = 0; i < length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                return bytes.buffer;
            }
            
            // Enable the Play button
            function enablePlayButton() {
                var playButton = document.getElementById('playButton');
                playButton.disabled = false;
            }
            
            // Play the audio buffer
            function playAudioBuffer() {
                var source = audioContext.createBufferSource();
                source.buffer = audioBuffer;
                source.connect(audioContext.destination);
                source.start();
            }
            
            // Handle form submission
            var form = document.getElementById('inputForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                var userInput = document.getElementById('textInput').value;
                if (userInput.trim() !== '') {
                    sendRequest(userInput);
                }
            });
            
            // Create the audio context when the document is loaded
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        });
    </script>
</head>
<body>
    <form id="inputForm">
        <input type="text" id="textInput" required>
        <button type="submit">Submit</button>
    </form>
    
    <button id="playButton" disabled onclick="playAudioBuffer()">Play</button>
</body>
</html>
